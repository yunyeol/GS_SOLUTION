<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.alarmeweb.mapper.ReceiverMapper">
    <resultMap id="receiverResult" type="Receiver">
        <id 	property="addrGrpId" 		column="ADDRESS_GRP_ID"/>
        <result property="addrGrpName" 		column="ADDRESS_GRP_NAME"/>
        <result property="addrGrpMbrCnt" 	column="ADRESS_GRP_MBR_CNT"/>
        <result property="createdDt" 		column="REG_DATE"/>
        <result property="modifiedDt" 		column="UPT_DATE"/>
    </resultMap>

    <sql id="columns">
        GAG.ADDRESS_GRP_ID ADDRESS_GRP_ID,
        GAG.ADDRESS_GRP_NAME ADDRESS_GRP_NAME,
        COUNT(GAM.ADDRESS_GRP_ID) ADRESS_GRP_MBR_CNT,
        GAG.REG_DATE REG_DATE,
        GAG.UPT_DATE UPT_DATE
    </sql>
    <select id="getReceiverList" resultMap="receiverResult">
        /* receiverMapper.getGroupList */
        SELECT
        <include refid="columns" />
        FROM GS_ADDRESS_GRP GAG
        LEFT JOIN GS_ADDRESS_MBR GAM
        ON (GAG.ADDRESS_GRP_ID = GAM.ADDRESS_GRP_ID)
        <include refid="condition" />
        GROUP BY GAG.ADDRESS_GRP_ID,GAG.REG_DATE, GAG.UPT_DATE, GAM.ADDRESS_GRP_ID
    </select>

    <select id="getReceivGrpNameCnt" resultType="int" parameterType="String">
        /* receiverMapper.getReceivGrpNameCnt */
        SELECT
        COUNT(1)
        FROM
        GS_ADDRESS_GRP
        <include refid="condition" />
    </select>

    <insert id="insertReceiver" parameterType="Receiver">
      /* receiverMapper.insertReceiver */
      INSERT INTO GS_ADDRESS_GRP(ADDRESS_GRP_NAME, LOGIN_ID, REG_DATE, UPT_DATE)
      VALUES(#{addrGrpName}, #{loginId}, now(), now())
    </insert>

    <update id="updateReceiver" parameterType="Receiver">
      UPDATE GS_ADDRESS_GRP
      SET ADDRESS_GRP_NAME = #{addrGrpName}
      WHERE ADDRESS_GRP_ID = #{addrGrpId}
    </update>

    <delete id="deleteReceiver" parameterType="long">
      /* receiverMapper.deleteReceiver */
      DELETE FROM GS_ADDRESS_GRP
      WHERE ADDRESS_GRP_ID = #{addrGrpId}
    </delete>

    <sql id="condition">
        <where>
            <if test=" addrGrpName != null and addrGrpName != '' ">
                ADDRESS_GRP_NAME = #{addrGrpName};
            </if>
        </where>
    </sql>

</mapper>

